# Designing a Domain Model

**CS296N ASP.NET Core MVC**



| Weekly topics                             |                            |
| ----------------------------------------- | -------------------------- |
| 1. Intro to course and Input validation   | 6. Security                |
| 2. Identity                               | 7. Creating a Web Service  |
| 3. Authentication                         | 8. Consuming a Web Service |
| 4. Authorization                          | 9. Docker containers       |
| 5. Async/Await & **Complex Domain Model** | 10. Term project           |

## Contents

[TOC]

## Review: Designing Domain Models for ASP.NET Core MVC

### What is a domain model?

- What is the meaning of "[domain](https://www.wolframalpha.com/input/?i=domain)" in general, in math?
- What is meant by the problem "domain" in software development?
- When we design a set of classes to model a problem's domain, how do we identify those classes?
  - What will nouns become?
  - What will verbs become?
  - Do we represent all the nouns and verbs in our domain model?
- What kind of UML diagram do we draw when we create our domain model?

### What are the three primary OOP relationships?

- What are the names and meanings of these relationships?

- How do we represent them in UML?
- What is cardinality?
- How do we implement them in C#?

### What constraints are imposed by Entity Framework?

- Which OOP relationships are allowed and/or useful?
- Are there work-arounds for relationships that aren't allowed?
- What is a circular relationship? Are those OK?
- Do all domain model classes need to be related? If not, how do we decide?
- How will users be modeled if we are using Identity?



## Example: Good Book Nook Domain Model

### Description of the problem domain

This web site lets users enter book reviews, which include information on the book: title, publication date, author, and the author's birth date. Once a book has been reviewed by one user, it can be reviewed by other users as well. Users my also make comments on reviews.

### UML diagram

[Domain model UML class diagram](BookInfo3DomainModel.pdf)

### C# code

Code based on the UML class diagram:

```c#
public class AppUser : IdentityUser
{
  public string Name { get; set; }  // Real name
}

public class Book
{
  private List<Author> authors = new List<Author>();
  private List<Review> reviews = new List<Review>();

  public int BookID { get; set; }
  public List<Author> Authors { get { return authors; } }
  public List<Review> Reviews { get { return reviews; } }
  public string Title { get; set; }
  public DateTime PubDate { get; set; }
}

public class Author
{
  public int AuthorID { get; set; }
  public string Name { get; set; }
  public DateTime Birthday { get; set; }
}

public class Review
{
  private List<Comment> comments = new List<Comment>();
  
  public List<Comment> Comments { get { return comments; } }
  public int ReviewID { get; set; }
  public string ReviewText { get; set; }
  public AppUser Reviewer { get; set; }
}

public class Comment
    {
        public int CommentID { get; set; }
        public string CommentText { get; set; }
        public AppUser UserName { get; set; }
        public Review UserReview { get; set; }
    }
```

### Questions

- How is aggregation being implemented?
- How is composition being implemented?
- What is it in the UML class diagram that got translated into lists?
- Why are the lists read only (only a `get` on the property)
- Why are there both public `List` properties and private `List` fields?
- Will EF generate any tables with one-to-many relationships? Many-to-many relationships?
- Will EF generate any junction tables?
- Do we need a many-to-many relationship to manage books that have multiple authors and authors that have written multiple books?

### The database

Look at the database generated by EF.



## Exercise: Modify the BookReview web site





## Answers

### Three primary OOP relationships

- Aggregation (aka association)
  The "has-a" relationship.
- Composition
  The "is-a-part-of" relationship.
  
  This is a stronger relationship than aggregation. The part can't exist without the whole.
- Inheritance
  The "is-a" relationship.

### Work-around for implementing many-to-many relationships

Use an [*association class*](https://www.ibm.com/support/knowledgecenter/SSCLKU_7.5.5/com.ibm.xtools.modeler.doc/topics/cassnclss.html). This will be translated to a *junction table* in the database.

------

 [![Creative Commons License](https://i.creativecommons.org/l/by/4.0/88x31.png)](http://creativecommons.org/licenses/by/4.0/)System Design  Lecture Notes by [Brian Bird](https://profbird.online), 2018 (Revised 2020), are licensed under a [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/). 

------